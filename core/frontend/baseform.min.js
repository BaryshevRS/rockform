!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.form.min","jquery.mask.min","jquery.rtooltip"],t):t(jQuery)}(function(t){"use strict";var e="rockform",i="",n={};t(document).on("change",".bf-input-file",function(e){var i=t(this),n=i.next("label"),o=n.html(),a="";this.files&&this.files.length>1?a=(this.getAttribute("data-multiple-caption")||"").replace("{count}",this.files.length):e.target.value&&(a=e.target.value.split("\\").pop()),a?n.find("span").html(a):n.html(o)});var o=window.MutationObserver||window.WebKitMutationObserver||"";if(o.length>0){var o=window.MutationObserver||window.WebKitMutationObserver,a=function(e){e.map(function(e){var i=t(e.addedNodes);i.find("img[data-bf-capcha]").click()})},f=new o(a),r={childList:!0,subtree:!0};f.observe(document.getElementsByTagName("body")[0],r)}var c={init:function(){c.update(),t(document).off("click","img[data-bf-capcha]").on("click","img[data-bf-capcha]",function(){c.update()})},update:function(){t("img[data-bf-capcha]").attr("src",d.path+"?type=capcha&u="+Math.random())}},s={init:function(){t(document).on("focus","[data-bf-mask]",function(){s.set(t(this))}),t("[data-bf-mask]").each(function(){s.set(t(this))})},set:function(t){i=t.data("bf-mask"),n=t.attr("placeholder"),i.length>0&&(("undefined"==typeof n||n.length<1)&&(n=i.replace(/[a-z0-9]+?/gi,"_")),n={placeholder:n},t.mask(i,n))}},u={server:function(e,i,n){var o,a,f=0;return t(".bf-tooltip").rtooltip("reset"),i.mail_to?(t('[type="submit"], [type="image"]',e).rtooltip({msg:i.mail_to}),!1):i.filesize?(t('[type="submit"], [type="image"]',e).rtooltip({msg:i.filesize}),!1):(t.each(i,function(n,r){o="","token"==n?d.set_attr_form(e,i.token,"bf-token"):"filesize"==n||(o=u.set_err_msg(r),a=t('[name="'+n+'"]',e),a.rtooltip({msg:o}),o.length>0&&(f=1))}),!(parseInt(f)>0))},set_err_msg:function(e){var i="";return e.required?i=e.required:e.rangelength?i=e.rangelength:e.minlength?i=e.minlength:e.maxlength?i=e.maxlength:t.each(e,function(t,e){if("required"!=t&&"rangelength"!=t&&"minlength"!=t&&"maxlength"!=t)return i=e,!1}),i}},l={init:function(e,i,n,o){t.ajax({url:e,data:i,method:"post",dataType:"html",beforeSend:function(t){l.loader_on()},success:function(e){l.set_overlay(),l.set_close_event(),t(".bf-modal, .bf-fixed-overlay").css("opacity","0"),t(".bf-modal-box").html(e),l.loader_off(),t(".bf-modal, .bf-fixed-overlay").animate({opacity:"1"},400),n(o)}})},set_overlay:function(){t(".bf-fixed-overlay").remove(),t("body").append('<div class="bf-fixed-overlay bf-fixed-overlay__modal">                             <div class="bf-modal">                                 <div class="bf-modal_container">                                     <a href="javascript:;" data-bf-popup="close" class="bf-modal-close" title=""></a>                                       <div class="bf-modal-box"></div>                                 </div>                             </div>                             <small class="bf-modal-after"></small>                         </div>')},loader_on:function(){t("body").append('<div class="bf-loading"></div>')},loader_off:function(){t(".bf-loading").remove()},set_close_event:function(){t(document).on("click","[data-bf-popup='close'], .bf-fixed-overlay",function(){l.close()}),t(document).on("click",".bf-modal",function(t){t.stopImmediatePropagation()})},close:function(){t(".bf-fixed-overlay").remove(),d.init_form()}},d={config:"",path:"/"+e+"/init.php",timer:function(t){var e=2e3,i=t.data("bf-timer");return"undefined"!=typeof i&&parseInt(i)>0&&(e=i),e},init:function(){d.init_form(),d.init_popup_form()},init_popup_form:function(){t(document).on("click","[data-bf-config]:not(form)",function(e){e.preventDefault();var i=t(this).data("bf-config");("undefined"==typeof i||i.length<1)&&(i="");var n=d.get_custom_popup_attributes(t(this));l.init(d.path,{"bf-config":i,attributes:n,type:"form"},d.init_form,{config_popup:i,attributes:n})})},get_custom_popup_attributes:function(e){var i={},n="";return e.length&&t.each(e[0].attributes,function(t,e){n=e.name,/data\-bf\-field/.test(n)&&(n=n.replace("data-bf-",""),i[n]=e.value)}),i.field_page_h1=t("h1").html(),i.field_page_link=document.location.href,i},init_form:function(e){c.init(),s.init(),t(".bf-tooltip").rtooltip("reset"),t(document).off("submit","form[data-bf-config], .bf-modal form").on("submit","form[data-bf-config], .bf-modal form",function(i){i.preventDefault();var n=t(this);"undefined"==typeof e&&(e={},e.config_popup=""),d.config=d.get_config(e.config_popup,n.data("bf-config"));var o=n.formToArray(),a=[];t.each(o,function(t,e){"file"==e.type&&(o[t].size=e.value.size||"",o[t].value=e.value.name||"",a.push(o[t].size))}),t.post(d.path,{fields:o,type:"validation","bf-config":d.config,filesize:a},function(o){d.set_attr_form(n,d.config,"bf-config"),u.server(n,o,i)&&("undefined"!=typeof e.attributes&&t.each(e.attributes,function(t,e){d.set_attr_form(n,e,t)}),n.ajaxSubmit({beforeSubmit:function(e,i,n){t(":focus",i).prop("disabled",!0)},success:d.show_response,url:d.path,type:"post",dataType:"json",error:function(t,e,i){alert("Server: "+e)}})),t(".bf-attr").remove()})})},set_attr_form:function(t,e,i){t.prepend('<input name="'+i+'" class="bf-attr" type="hidden" value="'+e+'" />')},get_config:function(t,e){return"undefined"==typeof t||t.length<1?("undefined"==typeof e||e.length<1)&&(e=""):e=t,e},show_response:function(e,i,n,o){var a=t('[type="submit"], [type="image"]',o);a.prop("disabled",!1).removeAttr("disabled"),parseInt(e.status)>0?t.post(d.path,{type:"form_success","bf-config":e["bf-config"]},function(e){o.hide(),o.after(e),setTimeout(function(){l.close()},d.timer(o)),setTimeout(function(){o.show(),o.clearForm(),t("[data-bf-success]").remove()},d.timer(o)+1e3)},"html"):a.rtooltip({msg:e.value})},set_success_template:function(){}};d.init()});