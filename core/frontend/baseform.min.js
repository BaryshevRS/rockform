!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.form.min","jquery.mask.min","jquery.rtooltip","jquery.rmodal"],t):"object"==typeof module&&module.exports?module.exports=t(require("jquery")):t(jQuery)}(function(t){var e="rockform",n="",i={};t(document).on("change",".bf-input-file",function(e){var n=t(this),i=n.next("label"),a=i.html(),o="";this.files&&this.files.length>1?o=(this.getAttribute("data-multiple-caption")||"").replace("{count}",this.files.length):e.target.value&&(o=e.target.value.split("\\").pop()),o?i.find("span").html(o):i.html(a)});var a=window.MutationObserver||window.WebKitMutationObserver||"";if(a.length>0){var a=window.MutationObserver||window.WebKitMutationObserver,o=function(e){e.map(function(e){var n=t(e.addedNodes);n.find("img[data-bf-capcha]").click()})},r=new a(o),f={childList:!0,subtree:!0};r.observe(document.getElementsByTagName("body")[0],f)}var u={init:function(){u.update(),t(document).off("click","img[data-bf-capcha]").on("click","img[data-bf-capcha]",function(){u.update()})},update:function(){t("img[data-bf-capcha]").attr("src",p.path+"?type=capcha&u="+Math.random())}},s={init:function(){t(document).on("focus","[data-bf-mask]",function(){s.set(t(this))}),t("[data-bf-mask]").each(function(){s.set(t(this))})},set:function(t){n=t.data("bf-mask"),i=t.attr("placeholder"),n.length>0&&(("undefined"==typeof i||i.length<1)&&(i=n.replace(/[a-z0-9]+?/gi,"_")),i={placeholder:i},t.mask(n,i))}},c={server:function(e,n,i){var a,o,r=0;return t(".bf-tooltip").rtooltip("reset"),n.mail_to?(t('[type="submit"], [type="image"], [type="button"]',e).rtooltip({msg:n.mail_to}),!1):n.filesize?(t('[type="submit"], [type="image"], [type="button"]',e).rtooltip({msg:n.filesize}),!1):(t.each(n,function(i,f){a="","token"==i?p.set_attr_form(e,n.token,"bf-token"):"filesize"==i||(a=c.set_err_msg(f),o=t('[name="'+i+'"]',e),o.rtooltip({msg:a}),a.length>0&&(r=1))}),!(parseInt(r)>0))},set_err_msg:function(e){var n="";return e.required?n=e.required:e.rangelength?n=e.rangelength:e.minlength?n=e.minlength:e.maxlength?n=e.maxlength:t.each(e,function(t,e){if("required"!=t&&"rangelength"!=t&&"minlength"!=t&&"maxlength"!=t)return n=e,!1}),n}},p={config:"",path:"/"+e+"/init.php",timer:function(t){var e=2e3,n=t.data("bf-timer");return"undefined"!=typeof n&&parseInt(n)>0&&(e=n),e},init:function(){u.init(),s.init(),t(document).off("submit","form[data-bf-config], .bf-modal form").on("submit","form[data-bf-config], .bf-modal form",function(e){e.preventDefault(),t(".bf-tooltip").rtooltip("reset");var n=t(this);"undefined"==typeof param&&(param={},param.config_popup=""),p.config=p.get_config(param.config_popup,n.data("bf-config"));var i=n.formToArray(),a=[];t.each(i,function(t,e){"file"==e.type&&(i[t].size=e.value.size||"",i[t].value=e.value.name||"",a.push(i[t].size))}),t.post(p.path,{fields:i,type:"validation","bf-config":p.config,filesize:a},function(i){p.set_attr_form(n,p.config,"bf-config"),c.server(n,i,e)&&("undefined"!=typeof param.attributes&&t.each(param.attributes,function(t,e){p.set_attr_form(n,e,t)}),n.ajaxSubmit({beforeSubmit:function(e,n,i){t(":focus",n).prop("disabled",!0)},success:p.show_response,url:p.path,type:"post",dataType:"json",error:function(t,e,n){alert("Server: "+e)}})),t(".bf-attr").remove()})}),t.rmodal("[data-bf-config]:not(form)",{path:p.path,before:function(e,n){t(".bf-tooltip").rtooltip("reset");var i=t(e).data("bf-config")||"",a={attributes:p.get_attributes(e),"bf-config":i,type:"form"};return n.attributes=a,n}})},get_attributes:function(e){var n={},i="";return e.length&&t.each(e[0].attributes,function(t,e){i=e.name,/data\-bf\-field/.test(i)&&(i=i.replace("data-bf-",""),n[i]=e.value)}),n.field_page_h1=t("h1:first").text()||"",n.field_page_link=document.location.href,n},set_attr_form:function(t,e,n){t.prepend('<input name="'+n+'" class="bf-attr" type="hidden" value="'+e+'" />')},get_config:function(t,e){return"undefined"==typeof t||t.length<1?("undefined"==typeof e||e.length<1)&&(e=""):e=t,e},show_response:function(e,n,i,a){var o=t('[type="submit"], [type="image"], [type="button"]',a);o.prop("disabled",!1).removeAttr("disabled"),parseInt(e.status)>0?t.post(p.path,{type:"form_success","bf-config":e["bf-config"]},function(e){a.hide(),a.after(e),setTimeout(function(){t.rmodal("reset")},p.timer(a)),setTimeout(function(){a.show(),a.clearForm(),t("[data-bf-success]").remove()},p.timer(a)+1e3)},"html"):o.rtooltip({msg:e.value})}};p.init()});