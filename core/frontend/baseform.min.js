!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.form.min","jquery.mask.min"],t):t("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(t){"use strict";var e="rockform",o="",i={};if(t(document).on("change",".bf-input-file",function(e){var o=t(this),i=o.next("label"),n=i.html(),a="";this.files&&this.files.length>1?a=(this.getAttribute("data-multiple-caption")||"").replace("{count}",this.files.length):e.target.value&&(a=e.target.value.split("\\").pop()),a?i.find("span").html(a):i.html(n)}),window.MutationObserver||window.WebKitMutationObserver)var n=window.MutationObserver||window.WebKitMutationObserver,a=function(e){e.map(function(e){var o=t(e.addedNodes);o.find("img[data-bf-capcha]").click()})},f=new n(a),r={childList:!0,subtree:!0};f.observe(document.getElementsByTagName("body")[0],r);var s={init:function(){s.update(),t(document).off("click","img[data-bf-capcha]").on("click","img[data-bf-capcha]",function(){s.update()})},update:function(){t("img[data-bf-capcha]").attr("src",u.path+"?type=capcha&u="+Math.random())}},l={init:function(){t(document).on("focus","[data-bf-mask]",function(){l.set(t(this))}),t("[data-bf-mask]").each(function(){l.set(t(this))})},set:function(t){o=t.data("bf-mask"),i=t.attr("placeholder"),o.length>0&&(("undefined"==typeof i||i.length<1)&&(i=o.replace(/[a-z0-9]+?/gi,"_")),i={placeholder:i},t.mask(o,i))}},c={init:function(e,o){if(o.length>0)c.set({el:e,err_msg:o}),t(window).on("resize",{el:e,err_msg:o},c.set);else{var i=e.attr("name");i&&t('[data-bf-tooltip-id="'+i+'"]').remove()}},set:function(e){var o,i;e.data?(o=e.data.el,i=e.data.err_msg):(o=e.el,i=e.err_msg);var n=o.attr("name");o=t('[name="'+n+'"]:first',o.parents("form"));var a=o.attr("data-bf-tooltip");"undefined"!=typeof a?a=a.replace(/[ ]+?/gi,"-"):(a=o.parents("form").attr("data-bf-tooltip"),a=void 0===a?"top-right":a.replace(/[ ]+?/gi,"-")),t('[data-bf-tooltip-id="'+n+'"]').remove(),o.after('<div class="bf-tooltip bf-tooltip-'+a+'" data-bf-tooltip-id="'+n+'">                          <div class="bf-arrow"></div>'+i+"</div>"),c.position(o)},reset:function(){t(window).off("resize",c.set),t(".bf-tooltip").remove()},response:function(e,o,i,n,a){var f=20;a.css("white-space","nowrap");var r=e+o+f,s=t(window).outerWidth()-f-o;return r>t(window).outerWidth()&&(e=s),s<=i.left&&(a.css("white-space","normal"),e=i.left,a.width(n-f)),e},position:function(e){var o=5,i=e.offset();if("undefined"!=typeof i){var n=e.outerHeight(),a=e.outerWidth(),f=e.attr("name"),r=t('[data-bf-tooltip-id="'+f+'"]'),s=r.outerWidth(),l=r.outerHeight(),p=e.attr("data-bf-tooltip");if(void 0===p){var p=e.parents("form").attr("data-bf-tooltip");void 0===p&&(p="top right")}if("top right"==p){var d=i.left+a/6*5;d=c.response(d,s,i,a,r),l=r.outerHeight();var u=parseInt(i.top)-parseInt(l)-o;r.offset({top:u,left:d})}else if("top center"==p){var m=i.left+a/2;m=c.response(m,s,i,a,r),l=r.outerHeight(),r.offset({top:i.top-l,left:m})}else if("top"==p){var m=i.left;m=c.response(m,s,i,a,r),l=r.outerHeight(),r.offset({top:i.top-l,left:m})}else if("top left"==p){var d=i.left+a/6-s;l=r.outerHeight();var u=parseInt(i.top)-parseInt(l)-o;r.offset({top:u,left:d})}else if("left center"==p){var m=i.left-s;l=r.outerHeight(),r.offset({top:i.top+n/2-l/2,left:m})}else if("bottom"==p){var m=i.left;m=c.response(m,s,i,a,r),r.offset({top:i.top+n,left:m})}else if("bottom left"==p){var m=i.left+a/6-s;r.offset({top:i.top+n,left:m})}else if("bottom center"==p){var m=i.left+a/2;m=c.response(m,s,i,a,r),r.offset({top:i.top+n,left:m})}else if("bottom right"==p){var m=i.left+a/6*5;m=c.response(m,s,i,a,r),r.offset({top:i.top+n,left:m})}else if("right center"==p){var m=i.left+a;r.offset({top:i.top+n/2-l/2,left:m})}}}},p={server:function(e,o,i){var n,a,f=0;return c.reset(),console.log(o.filesize),o.mail_to?(/iPad|iPhone|iPod/g.test(navigator.userAgent)?c.init(t('[type="submit"], [type="image"]',e),o.mail_to):c.init(t(":focus",e),o.mail_to),!1):o.filesize?(/iPad|iPhone|iPod/g.test(navigator.userAgent)?c.init(t('[type="submit"], [type="image"]',e),o.filesize):c.init(t(":focus",e),o.filesize),!1):(t.each(o,function(i,r){n="","token"==i?u.set_attr_form(e,o.token,"bf-token"):(n=p.set_err_msg(r),a=t('[name="'+i+'"]',e),c.init(a,n),n.length>0&&(f=1))}),!(parseInt(f)>0))},set_err_msg:function(e){var o="";return e.required?o=e.required:e.rangelength?o=e.rangelength:e.minlength?o=e.minlength:e.maxlength?o=e.maxlength:t.each(e,function(t,e){if("required"!=t&&"rangelength"!=t&&"minlength"!=t&&"maxlength"!=t)return o=e,!1}),o}},d={init:function(e,o,i,n){t.ajax({url:e,data:o,method:"post",dataType:"html",beforeSend:function(t){d.loader_on()},success:function(e){d.set_overlay(),d.set_close_event(),t(".bf-modal, .bf-fixed-overlay").css("opacity","0"),t(".bf-modal-box").html(e),d.loader_off(),t(".bf-modal, .bf-fixed-overlay").animate({opacity:"1"},400),i(n)}})},set_overlay:function(){t(".bf-fixed-overlay").remove(),t("body").append('<div class="bf-fixed-overlay bf-fixed-overlay__modal">                             <div class="bf-modal">                                 <div class="bf-modal_container">                                     <a href="javascript:;" data-bf-popup="close" class="bf-modal-close" title=""></a>                                       <div class="bf-modal-box"></div>                                 </div>                             </div>                             <small class="bf-modal-after"></small>                         </div>')},loader_on:function(){t("body").append('<div class="bf-loading"></div>')},loader_off:function(){t(".bf-loading").remove()},set_close_event:function(){t(document).on("click","[data-bf-popup='close'], .bf-fixed-overlay",function(){d.close()}),t(document).on("click",".bf-modal",function(t){t.stopImmediatePropagation()})},close:function(){t(".bf-fixed-overlay").remove(),u.init_form()}},u={config:"",path:"/"+e+"/init.php",timer:function(t){var e=2e3,o=t.data("bf-timer");return"undefined"!=typeof o&&parseInt(o)>0&&(e=o),e},init:function(){u.init_form(),u.init_popup_form()},init_popup_form:function(){t(document).on("click","[data-bf-config]:not(form)",function(e){e.preventDefault();var o=t(this).data("bf-config");("undefined"==typeof o||o.length<1)&&(o="");var i=u.get_custom_popup_attributes(t(this));d.init(u.path,{"bf-config":o,attributes:i,type:"form"},u.init_form,{config_popup:o,attributes:i})})},get_custom_popup_attributes:function(e){var o={},i="";return e.length&&t.each(e[0].attributes,function(t,e){i=e.name,/data\-bf\-field/.test(i)&&(i=i.replace("data-bf-",""),o[i]=e.value)}),o.field_page_h1=t("h1").html(),o.field_page_link=document.location.href,o},init_form:function(e){s.init(),l.init(),c.reset(),t(document).on("mouseover",".bf-tooltip",function(){t(this).remove()}),t(document).off("submit","form[data-bf-config], .bf-modal form").on("submit","form[data-bf-config], .bf-modal form",function(o){o.preventDefault();var i=t(this);"undefined"==typeof e&&(e={},e.config_popup=""),u.config=u.get_config(e.config_popup,i.data("bf-config"));var n=i.formToArray(),a=[];t.each(n,function(t,e){"file"==e.type&&(n[t].size=e.value.size||"",n[t].value=e.value.name||"",a.push(n[t].size))}),t.post(u.path,{fields:n,type:"validation","bf-config":u.config,filesize:a},function(n){u.set_attr_form(i,u.config,"bf-config"),p.server(i,n,o)&&("undefined"!=typeof e.attributes&&t.each(e.attributes,function(t,e){u.set_attr_form(i,e,t)}),i.ajaxSubmit({beforeSubmit:function(e,o,i){t(":focus",o).prop("disabled",!0)},success:u.show_response,url:u.path,type:"post",dataType:"json",error:function(t,e,o){alert("Server: "+e)}})),t(".bf-attr").remove()})})},set_attr_form:function(t,e,o){t.prepend('<input name="'+o+'" class="bf-attr" type="hidden" value="'+e+'" />')},get_config:function(t,e){return"undefined"==typeof t||t.length<1?("undefined"==typeof e||e.length<1)&&(e=""):e=t,e},show_response:function(e,o,i,n){var a=t('input[type="submit"], button:last',n);a.prop("disabled",!1).removeAttr("disabled"),parseInt(e.status)>0?t.post(u.path,{type:"form_success","bf-config":e["bf-config"]},function(e){n.hide(),n.after(e),setTimeout(function(){d.close()},u.timer(n)),setTimeout(function(){n.show(),n.clearForm(),t("[data-bf-success]").remove()},u.timer(n)+1e3)},"html"):c.init(a,e.value)},set_success_template:function(){}};u.init()});