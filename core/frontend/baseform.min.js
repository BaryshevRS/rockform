!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.form.min","jquery.mask.min","jquery.rtooltip","jquery.rmodal"],t):"object"==typeof module&&module.exports?module.exports=t(require("jquery")):t(jQuery)}(function(t){var e=window.baseform||{};e=function(){function e(e,o){var n,i=this;i.defaults={config:"",path:"/rockform/init.php",timer:2e3,before_send_form:function(){},after_send_form:function(){},before_show_modal:function(){},after_show_modal:function(){},close_modal:function(){}},n=t(e).data("bf")||{},n=JSON.parse("{}"),i.options=t.extend({},i.defaults,o,n),i.init(e)}return e}(),e.prototype.fileupload=function(e){t(document).on("change",".bf-input-file",function(e){var o=t(this),n=o.next("label"),i=n.html(),a="";this.files&&this.files.length>1?a=(this.getAttribute("data-multiple-caption")||"").replace("{count}",this.files.length):e.target.value&&(a=e.target.value.split("\\").pop()),a?n.find("span").html(a):n.html(i)})},e.prototype.capcha=function(e){var o=this,n=window.MutationObserver||window.WebKitMutationObserver||"";if(n.length>0){var n=window.MutationObserver||window.WebKitMutationObserver,i=function(e){e.map(function(e){var o=t(e.addedNodes);o.find("img[data-bf-capcha]").click()})},a=new n(i),f={childList:!0,subtree:!0};a.observe(document,f)}var r={init:function(){r.update(),t(document).off("click","img[data-bf-capcha]").on("click","img[data-bf-capcha]",function(){r.update()})},update:function(){t("img[data-bf-capcha]").attr("src",o.options.path+"?type=capcha&u="+Math.random())}};r.init()},e.prototype.mask_fields=function(e){var o="",n={},i={init:function(){t(document).on("focus","[data-bf-mask]",function(){i.set(t(this))}),t("[data-bf-mask]").each(function(){i.set(t(this))})},set:function(t){o=t.data("bf-mask"),n=t.attr("placeholder"),o.length>0&&(("undefined"==typeof n||n.length<1)&&(n=o.replace(/[a-z0-9]+?/gi,"_")),n={placeholder:n},t.mask(o,n))}};i.init()},e.prototype.validation=function(e,o){var n=this,i={init:function(e,o){var a,f;return valid=0,o=o||{},t(".bf-tooltip").rtooltip("reset"),o.mail_to?(t('[type="submit"], [type="image"], [type="button"]',e).rtooltip({msg:o.mail_to}),!1):o.filesize?(t('[type="submit"], [type="image"], [type="button"]',e).rtooltip({msg:o.filesize}),!1):(t.each(o,function(r,u){a="","token"==r?n.set_attr_form(e,o.token,"bf-token"):"filesize"==r||(a=i.set_err_msg(u),f=t('[name="'+r+'"]',e),f.rtooltip({msg:a}),a.length>0&&(valid=1))}),!(parseInt(valid)>0))},set_err_msg:function(e){var o="";return e.required?o=e.required:e.rangelength?o=e.rangelength:e.minlength?o=e.minlength:e.maxlength?o=e.maxlength:t.each(e,function(t,e){if("required"!=t&&"rangelength"!=t&&"minlength"!=t&&"maxlength"!=t)return o=e,!1}),o}};return i.init(e,o)},e.prototype.set_attr_form=function(t,e,o){t.prepend('<input name="'+o+'" class="bf-attr" type="hidden" value="'+e+'" />')},e.prototype.init=function(e){var o=this,n={init:function(e){e=e||"",o.capcha(),o.mask_fields(),t(document).off("submit","form[data-bf-config], .bf-modal form").on("submit","form[data-bf-config], .bf-modal form",function(e){e.preventDefault(),t(".bf-tooltip").rtooltip("reset");var i=t(this);"undefined"==typeof param&&(param={},param.config_popup=""),o.options.config=n.get_config(param.config_popup,i.data("bf-config"));var a=i.formToArray(),f=[];t.each(a,function(t,e){"file"==e.type&&(a[t].size=e.value.size||"",a[t].value=e.value.name||"",f.push(a[t].size))}),t.post(o.options.path,{fields:a,type:"validation","bf-config":o.options.config,filesize:f},function(e){e=e||{},o.set_attr_form(i,o.options.config,"bf-config"),o.validation(i,e)&&("undefined"!=typeof param.attributes&&t.each(param.attributes,function(t,e){n.set_attr_form(i,e,t)}),i.ajaxSubmit({beforeSubmit:function(e,o,n){t(":focus",o).prop("disabled",!0)},success:n.show_response,url:o.options.path,type:"post",dataType:"json",error:function(t,e,o){alert("Server: "+e)}})),t(".bf-attr").remove()})}),t.rmodal("[data-bf-config]:not(form)",{path:o.options.path,before:function(e,o){t(".bf-tooltip").rtooltip("reset");var i=t(e).data("bf-config")||"",a={attributes:n.get_attributes(e),"bf-config":i,type:"form"};return o.attributes=a,o}}),console.log(">"+e),e.length>0&&t.rmodal(e,{path:o.options.path,before:function(e,o){t(".bf-tooltip").rtooltip("reset");var i=t(e).data("bf-config")||"",a={attributes:n.get_attributes(e),"bf-config":i,type:"form"};return o.attributes=a,o}})},get_attributes:function(e){var o={},n="";return e.length&&t.each(e[0].attributes,function(t,e){n=e.name,/data\-bf\-field/.test(n)&&(n=n.replace("data-bf-",""),o[n]=e.value)}),o.field_page_h1=t("h1:first").text()||"",o.field_page_link=document.location.href,o},get_config:function(t,e){return"undefined"==typeof t||t.length<1?("undefined"==typeof e||e.length<1)&&(e=""):e=t,e},show_response:function(e,n,i,a){var f=t('[type="submit"], [type="image"], [type="button"]',a);f.prop("disabled",!1).removeAttr("disabled"),parseInt(e.status)>0?t.post(o.options.path,{type:"form_success","bf-config":e["bf-config"]},function(e){a.hide(),a.after(e),setTimeout(function(){t.rmodal("reset")},o.options.timer),setTimeout(function(){a.show(),a.clearForm(),t("[data-bf-success]").remove()},o.options.timer+1e3)},"html"):f.rtooltip({msg:e.value})}};n.init(e)},t.rockform=function(t){var o=this,n=arguments[0]||{};return new e(t,n),o}}),function(t){t(function(){t.bf=function(e){var o=this,n=arguments[1]||{};t(e).data("data-bf-event",e);var i=t(e).data("bf-event")||"-";return console.log(i),defaults={before:function(){console.log("default")}},n=t.extend({},defaults,n),console.log(e),t(document).off("click",e).on("click",e,function(){return n.before(),!1}),o},t(document).off("click","[data-bf]").on("click","[data-bf]",function(){return console.log("0"),!1}),t.bf("a",{before:function(){console.log(1)}}),t.bf(".x3",{before:function(){console.log(2)}}),t.bf(".x4",{before:function(){console.log(3)}}),t.bf("[data-bf]",{before:function(){console.log(4)}})})}(jQuery);