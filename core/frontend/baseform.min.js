!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.form.min","jquery.mask.min","jquery.rtooltip","jquery.rmodal"],t):"object"==typeof module&&module.exports?module.exports=t(require("jquery")):t(jQuery)}(function(t){var e=window.baseform||{};e=function(){function e(e,n){var o,i=this;i.defaults={config:"",path:"/rockform/init.php",timer:2e3,before_send_form:function(){},after_send_form:function(){},before_show_modal:function(){},after_show_modal:function(){},close_modal:function(){}},o=t(e).data("bf")||{},i.options=t.extend({},i.defaults,n,o),i.init()}return e}(),e.prototype.fileupload=function(e){t(document).on("change",".bf-input-file",function(e){var n=t(this),o=n.next("label"),i=o.html(),a="";this.files&&this.files.length>1?a=(this.getAttribute("data-multiple-caption")||"").replace("{count}",this.files.length):e.target.value&&(a=e.target.value.split("\\").pop()),a?o.find("span").html(a):o.html(i)})},e.prototype.capcha=function(e){var n=this,o=window.MutationObserver||window.WebKitMutationObserver||"";if(o.length>0){var o=window.MutationObserver||window.WebKitMutationObserver,i=function(e){e.map(function(e){var n=t(e.addedNodes);n.find("img[data-bf-capcha]").click()})},a=new o(i),r={childList:!0,subtree:!0};a.observe(document,r)}var f={init:function(){f.update(),t(document).off("click","img[data-bf-capcha]").on("click","img[data-bf-capcha]",function(){f.update()})},update:function(){t("img[data-bf-capcha]").attr("src",n.options.path+"?type=capcha&u="+Math.random())}};f.init()},e.prototype.mask_fields=function(e){var n="",o={},i={init:function(){t(document).on("focus","[data-bf-mask]",function(){i.set(t(this))}),t("[data-bf-mask]").each(function(){i.set(t(this))})},set:function(t){n=t.data("bf-mask"),o=t.attr("placeholder"),n.length>0&&(("undefined"==typeof o||o.length<1)&&(o=n.replace(/[a-z0-9]+?/gi,"_")),o={placeholder:o},t.mask(n,o))}};i.init()},e.prototype.validation=function(e,n){var o=this,i={init:function(e,n){var a,r;return valid=0,n=n||{},t(".bf-tooltip").rtooltip("reset"),n.mail_to?(t('[type="submit"], [type="image"], [type="button"]',e).rtooltip({msg:n.mail_to}),!1):n.filesize?(t('[type="submit"], [type="image"], [type="button"]',e).rtooltip({msg:n.filesize}),!1):(t.each(n,function(f,u){a="","token"==f?o.set_attr_form(e,n.token,"bf-token"):"filesize"==f||(a=i.set_err_msg(u),r=t('[name="'+f+'"]',e),r.rtooltip({msg:a}),a.length>0&&(valid=1))}),!(parseInt(valid)>0))},set_err_msg:function(e){var n="";return e.required?n=e.required:e.rangelength?n=e.rangelength:e.minlength?n=e.minlength:e.maxlength?n=e.maxlength:t.each(e,function(t,e){if("required"!=t&&"rangelength"!=t&&"minlength"!=t&&"maxlength"!=t)return n=e,!1}),n}};return i.init(e,n)},e.prototype.set_attr_form=function(t,e,n){t.prepend('<input name="'+n+'" class="bf-attr" type="hidden" value="'+e+'" />')},e.prototype.init=function(e){var n=this,o={init:function(){n.capcha(),n.mask_fields(),t(document).off("submit","form[data-bf-config], .bf-modal form").on("submit","form[data-bf-config], .bf-modal form",function(e){e.preventDefault(),t(".bf-tooltip").rtooltip("reset");var i=t(this);"undefined"==typeof param&&(param={},param.config_popup=""),n.options.config=o.get_config(param.config_popup,i.data("bf-config"));var a=i.formToArray(),r=[];t.each(a,function(t,e){"file"==e.type&&(a[t].size=e.value.size||"",a[t].value=e.value.name||"",r.push(a[t].size))}),t.post(n.options.path,{fields:a,type:"validation","bf-config":n.options.config,filesize:r},function(e){e=e||{},n.set_attr_form(i,n.options.config,"bf-config"),n.validation(i,e)&&("undefined"!=typeof param.attributes&&t.each(param.attributes,function(t,e){o.set_attr_form(i,e,t)}),i.ajaxSubmit({beforeSubmit:function(e,n,o){t(":focus",n).prop("disabled",!0)},success:o.show_response,url:n.options.path,type:"post",dataType:"json",error:function(t,e,n){alert("Server: "+e)}})),t(".bf-attr").remove()})}),t.rmodal("[data-bf-config]:not(form)",{path:n.options.path,before:function(e,n){t(".bf-tooltip").rtooltip("reset");var i=t(e).data("bf-config")||"",a={attributes:o.get_attributes(e),"bf-config":i,type:"form"};return n.attributes=a,n}})},get_attributes:function(e){var n={},o="";return e.length&&t.each(e[0].attributes,function(t,e){o=e.name,/data\-bf\-field/.test(o)&&(o=o.replace("data-bf-",""),n[o]=e.value)}),n.field_page_h1=t("h1:first").text()||"",n.field_page_link=document.location.href,n},get_config:function(t,e){return"undefined"==typeof t||t.length<1?("undefined"==typeof e||e.length<1)&&(e=""):e=t,e},show_response:function(e,o,i,a){var r=t('[type="submit"], [type="image"], [type="button"]',a);r.prop("disabled",!1).removeAttr("disabled"),parseInt(e.status)>0?t.post(n.options.path,{type:"form_success","bf-config":e["bf-config"]},function(e){a.hide(),a.after(e),setTimeout(function(){t.rmodal("reset")},n.options.timer),setTimeout(function(){a.show(),a.clearForm(),t("[data-bf-success]").remove()},n.options.timer+1e3)},"html"):r.rtooltip({msg:e.value})}};o.init()},t.fn.rockform=function(t){var n=this,o=arguments[0];return console.log(o),"object"!=typeof o&&"undefined"!=typeof o||new e(n,o),n}}),function(t){t(function(){t("a").rockform({config:"xxx",before_send_form:function(){alert(1)}})})}(jQuery);