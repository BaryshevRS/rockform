!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.form.min","jquery.mask.min"],t):t("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(t){"use strict";var e="rockform",o="",f={},i={init:function(){t("[data-bf-mask]").each(function(){o=t(this).data("bf-mask"),f=t(this).data("bf-placeholder"),o.length>0&&(("undefined"==typeof f||f.length<1)&&(f=o.replace(/[a-z0-9]+?/gi,"_")),f={placeholder:f},t(this).mask(o,f))})}},n={init:function(e,o){if(o.length>0)n.set({el:e,err_msg:o}),t(window).on("resize",{el:e,err_msg:o},n.set);else{var f=e.attr("name");f&&t('[data-bf-tooltip-id="'+f+'"]').remove()}},set:function(e){var o,f;e.data?(o=e.data.el,f=e.data.err_msg):(o=e.el,f=e.err_msg);var i=o.attr("name"),a=o.attr("data-bf-tooltip");a="undefined"!=typeof a?a.replace(/[ ]+?/gi,"-"):"bottom-right",t('[data-bf-tooltip-id="'+i+'"]').remove(),o.after('<div class="bf-tooltip bf-tooltip-'+a+'" data-bf-tooltip-id="'+i+'">                          <div class="bf-arrow"></div>'+f+"</div>"),n.position(o)},reset:function(){t(window).off("resize",n.set),t(".bf-tooltip").remove()},response:function(e,o,f,i,n,a){var r=e+o+f,s=t(window).outerWidth()-f-o;return r>t(window).outerWidth()&&(e=s),s<=i.left&&(e=i.left,a.width(n-f)),e},position:function(e){var o=20,f=e.offset();if("undefined"!=typeof f){var i=e.outerHeight(),a=e.outerWidth(),r=e.attr("name"),s=t('[data-bf-tooltip-id="'+r+'"]'),l=s.outerWidth(),d=s.outerHeight(),c=e.attr("data-bf-tooltip");if(void 0===c&&(c="bottom right"),"top right"==c){var p=f.left+a/6*5;p=n.response(p,l,o,f,a,s),s.offset({top:f.top-d,left:p})}else if("top center"==c){var p=f.left+a/2;p=n.response(p,l,o,f,a,s),s.offset({top:f.top-d,left:p})}else if("top"==c){var p=f.left-a/6*5;s.offset({top:f.top-d,left:p})}else if("top left"==c){var p=f.left;p=n.response(p,l,o,f,a,s),s.offset({top:f.top-d,left:p})}else if("left center"==c){var p=f.left-l;s.offset({top:f.top+i/2-d/2,left:p})}else if("bottom"==c){var p=f.left-a/6*5;s.offset({top:f.top+i,left:p})}else if("bottom left"==c){var p=f.left;p=n.response(p,l,o,f,a,s),s.offset({top:f.top+i,left:p})}else if("bottom center"==c){var p=f.left+a/2;p=n.response(p,l,o,f,a,s),s.offset({top:f.top+i,left:p})}else if("bottom right"==c){var p=f.left+a/6*5;p=n.response(p,l,o,f,a,s),s.offset({top:f.top+i,left:p})}else if("right center"==c){var p=f.left+a;s.offset({top:f.top+i/2-d/2,left:p})}}}},a={server:function(e,o){var f,i,r=0;return n.reset(),t(".bf-status").remove(),o.mail_to?(e.before('<div class="bf-status bf-status-0">'+o.mail_to+"</div>"),!1):(t.each(o,function(s,d){f="","token"==s?l.set_attr_form(e,o.token,"bf-token"):(f=a.set_err_msg(d),i=t('[name="'+s+'"]',e),n.init(i,f),f.length>0&&(r=1))}),!(parseInt(r)>0))},set_err_msg:function(e){var o="";return e.required?o=e.required:e.rangelength?o=e.rangelength:e.minlength?o=e.minlength:e.maxlength?o=e.maxlength:t.each(e,function(t,e){return"required"!=t&&"rangelength"!=t&&"minlength"!=t&&"maxlength"!=t?(o=e,!1):void 0}),o}},r={init:function(e,o,f,i){t.ajax({url:e,data:o,method:"post",dataType:"html",beforeSend:function(t){r.loader_on()},success:function(e){r.set_overlay(),r.set_close_event(),t(".bf-modal, .bf-fixed-overlay").css("opacity","0"),t(".bf-modal-box").html(e),r.loader_off(),t(".bf-modal, .bf-fixed-overlay").animate({opacity:"1"},400),f(i)}})},set_overlay:function(){t("body").append('<div class="bf-fixed-overlay bf-fixed-overlay__modal">                             <div class="bf-modal">                                 <div class="bf-modal_container">                                     <a href="javascript:;" class="bf-modal-close" title=""></a>                                       <div class="bf-modal-box"></div>                                 </div>                             </div>                         </div>')},loader_on:function(){t("body").append('<div class="bf-loading"></div>')},loader_off:function(){t(".bf-loading").remove()},set_close_event:function(){t(".bf-modal-close, .bf-fixed-overlay").one("click",function(){t(".bf-fixed-overlay").remove(),l.init_form()}),t(".bf-modal").on("click",function(t){t.stopImmediatePropagation()})}},s={init:function(){var e=t('[data-bf-capcha=""]');e.off(),s.update(),e.on("click",function(){s.update()})},update:function(){t('[data-bf-capcha=""]').attr("src",l.path+"?type=capcha&u="+Math.random())}},l={config:"",path:"/"+e+"/init.php",init:function(){l.init_popup_form(),l.init_form()},init_popup_form:function(){t("[data-bf-config]").on("click",function(e){e.preventDefault();var o=t(this).data("bf-config");("undefined"==typeof o||o.length<1)&&(o="");var f=l.get_custom_popup_attributes(t(this));r.init(l.path,{"bf-config":o,attributes:f,type:"form"},l.init_form,{config_popup:o,attributes:f})}),t("form[data-bf-config]").off()},get_custom_popup_attributes:function(e){var o={},f="";return e.length&&t.each(e[0].attributes,function(t,e){f=e.name,/data\-bf\-field/.test(f)&&(f=f.replace("data-bf-",""),o[f]=e.value)}),o.field_page_h1=t("h1").html(),o.field_page_link=document.location.href,o},init_form:function(e){s.init(),i.init(),n.reset(),t("form[data-bf-config], .bf-modal form").off("submit"),t("form[data-bf-config], .bf-modal form").on("submit",function(o){o.preventDefault();var f=t(this);"undefined"==typeof e&&(e={},e.config_popup=""),l.config=l.get_config(e.config_popup,f.data("bf-config"));var i=f.formToArray();t.each(i,function(t,e){"file"==e.type&&(i[t].value=e.value.name)}),t.post(l.path,{fields:i,type:"validation","bf-config":l.config},function(o){l.set_attr_form(f,l.config,"bf-config"),a.server(f,o)&&("undefined"!=typeof e.attributes&&t.each(e.attributes,function(t,e){l.set_attr_form(f,e,t)}),f.ajaxSubmit({success:l.show_response,url:l.path,type:"post",dataType:"json"})),t(".bf-attr").remove()})})},set_attr_form:function(t,e,o){t.prepend('<input name="'+o+'" class="bf-attr" type="hidden" value="'+e+'" />')},get_config:function(t,e){return"undefined"==typeof t||t.length<1?("undefined"==typeof e||e.length<1)&&(e=""):e=t,e},show_response:function(e,o,f,i){t(".bf-status").remove(),i.before('<div class="bf-status bf-status-'+e.status+'">'+e.value+"</div>"),e.status>0&&(i.hide(),setTimeout(function(){t(".bf-modal-close").click()},2e3),setTimeout(function(){i.show(),t(".bf-status").remove(),i.clearForm()},3e3))}};l.init()});